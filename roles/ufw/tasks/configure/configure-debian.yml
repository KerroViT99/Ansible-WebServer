- name: Setting the default policy
  ufw:
    policy: deny
  when: firewall['name'] == "ufw"
  tags:
  - ufw

- name: Blocking access to the Apache port
  ufw:
    rule: deny
    port: "{{ apache['port'] }}"
    proto: tcp
  when: firewall['name'] == "ufw"
  tags:
  - ufw
  - security
  - block_apache_port

- name: Allow SSH access
  ufw:
    rule: allow
    name: OpenSSH
  tags:
  - ufw
  when: firewall['name'] == "ufw" and knockd['install'] == "no"

- name: Allowing HTTP traffic (Nginx)
  ufw:
    rule: allow
    name: Nginx HTTP
  tags:
  - ufw
  when: firewall['name'] == "ufw" and https['enable'] == "no"

- name: Allowing HTTP and HTTPS traffic (Nginx)
  ufw:
    rule: allow
    name: Nginx Full
  when: firewall['name'] == "ufw" and https['enable'] == "yes"
  tags:
  - ufw

- name: Allowing Apache
  ufw:
    rule: allow
    name: WWW
  when: firewall['name'] == "ufw"
  tags:
  - ufw

- name: Enabling UFW
  ufw:
    state: enabled
  when: firewall['name'] == "ufw"
  tags:
  - ufw
